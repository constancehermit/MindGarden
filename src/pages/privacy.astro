---
import BaseLayout from '../layouts/baseLayout.astro'
import { getCollection, render } from 'astro:content'

const policies = await getCollection('privacy')

function formatDate(date?: string) {
  if (!date) return null
  return new Date(date).toLocaleDateString('en-GB', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  })
}
---

<BaseLayout>
  <div class="container mx-auto px-4 py-8">
    <article class="px-4">
      {policies.length === 0 && <p>No privacy policy found.</p>}

      {
        await Promise.all(
          policies.map(async (p) => {
            const { Content } = await render(p)
            return (
              <>
                <h1 class="text-4xl py-4">{p.data.title}</h1>
                {p.data.updatedAt && (
                  <span>Last updated: {formatDate(p.data.updatedAt)}</span>
                )}
                <div class="mt-4 prose max-w-none">
                  <Content />
                </div>
              </>
            )
          })
        )
      }
    </article>
  </div>
</BaseLayout>
